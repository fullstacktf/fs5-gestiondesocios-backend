<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: curve25519_amd64.go in package vendor/golang.org/x/crypto/curve25519</title>
<link href="../../../../../../css/light-v0.1.6.css" rel="stylesheet">
<script src="../../../../../../jvs/golds-v0.1.6.js"></script>
<body><div>

<pre id="header"><code><span class="title">Source File</span>
	curve25519_amd64.go

<span class="title">Belonging Package</span>
	<a href="../../../../../../pkg/vendor/golang.org/x/crypto/curve25519.html">vendor/golang.org/x/crypto/curve25519</a>
</code></pre>

<pre class="line-numbers">
<span class="codeline" id="line-1"><code>// Copyright 2012 The Go Authors. All rights reserved.</code></span>
<span class="codeline" id="line-2"><code>// Use of this source code is governed by a BSD-style</code></span>
<span class="codeline" id="line-3"><code>// license that can be found in the LICENSE file.</code></span>
<span class="codeline" id="line-4"><code></code></span>
<span class="codeline" id="line-5"><code>// +build amd64,!gccgo,!appengine,!purego</code></span>
<span class="codeline" id="line-6"><code></code></span>
<span class="codeline" id="line-7"><code>package curve25519</code></span>
<span class="codeline" id="line-8"><code></code></span>
<span class="codeline" id="line-9"><code>// These functions are implemented in the .s files. The names of the functions</code></span>
<span class="codeline" id="line-10"><code>// in the rest of the file are also taken from the SUPERCOP sources to help</code></span>
<span class="codeline" id="line-11"><code>// people following along.</code></span>
<span class="codeline" id="line-12"><code></code></span>
<span class="codeline" id="line-13"><code>//go:noescape</code></span>
<span class="codeline" id="line-14"><code></code></span>
<span class="codeline" id="line-15"><code>func cswap(inout *[5]uint64, v uint64)</code></span>
<span class="codeline" id="line-16"><code></code></span>
<span class="codeline" id="line-17"><code>//go:noescape</code></span>
<span class="codeline" id="line-18"><code></code></span>
<span class="codeline" id="line-19"><code>func ladderstep(inout *[5][5]uint64)</code></span>
<span class="codeline" id="line-20"><code></code></span>
<span class="codeline" id="line-21"><code>//go:noescape</code></span>
<span class="codeline" id="line-22"><code></code></span>
<span class="codeline" id="line-23"><code>func freeze(inout *[5]uint64)</code></span>
<span class="codeline" id="line-24"><code></code></span>
<span class="codeline" id="line-25"><code>//go:noescape</code></span>
<span class="codeline" id="line-26"><code></code></span>
<span class="codeline" id="line-27"><code>func mul(dest, a, b *[5]uint64)</code></span>
<span class="codeline" id="line-28"><code></code></span>
<span class="codeline" id="line-29"><code>//go:noescape</code></span>
<span class="codeline" id="line-30"><code></code></span>
<span class="codeline" id="line-31"><code>func square(out, in *[5]uint64)</code></span>
<span class="codeline" id="line-32"><code></code></span>
<span class="codeline" id="line-33"><code>// mladder uses a Montgomery ladder to calculate (xr/zr) *= s.</code></span>
<span class="codeline" id="line-34"><code>func mladder(xr, zr *[5]uint64, s *[32]byte) {</code></span>
<span class="codeline" id="line-35"><code>	var work [5][5]uint64</code></span>
<span class="codeline" id="line-36"><code></code></span>
<span class="codeline" id="line-37"><code>	work[0] = *xr</code></span>
<span class="codeline" id="line-38"><code>	setint(&amp;work[1], 1)</code></span>
<span class="codeline" id="line-39"><code>	setint(&amp;work[2], 0)</code></span>
<span class="codeline" id="line-40"><code>	work[3] = *xr</code></span>
<span class="codeline" id="line-41"><code>	setint(&amp;work[4], 1)</code></span>
<span class="codeline" id="line-42"><code></code></span>
<span class="codeline" id="line-43"><code>	j := uint(6)</code></span>
<span class="codeline" id="line-44"><code>	var prevbit byte</code></span>
<span class="codeline" id="line-45"><code></code></span>
<span class="codeline" id="line-46"><code>	for i := 31; i &gt;= 0; i-- {</code></span>
<span class="codeline" id="line-47"><code>		for j &lt; 8 {</code></span>
<span class="codeline" id="line-48"><code>			bit := ((*s)[i] &gt;&gt; j) &amp; 1</code></span>
<span class="codeline" id="line-49"><code>			swap := bit ^ prevbit</code></span>
<span class="codeline" id="line-50"><code>			prevbit = bit</code></span>
<span class="codeline" id="line-51"><code>			cswap(&amp;work[1], uint64(swap))</code></span>
<span class="codeline" id="line-52"><code>			ladderstep(&amp;work)</code></span>
<span class="codeline" id="line-53"><code>			j--</code></span>
<span class="codeline" id="line-54"><code>		}</code></span>
<span class="codeline" id="line-55"><code>		j = 7</code></span>
<span class="codeline" id="line-56"><code>	}</code></span>
<span class="codeline" id="line-57"><code></code></span>
<span class="codeline" id="line-58"><code>	*xr = work[1]</code></span>
<span class="codeline" id="line-59"><code>	*zr = work[2]</code></span>
<span class="codeline" id="line-60"><code>}</code></span>
<span class="codeline" id="line-61"><code></code></span>
<span class="codeline" id="line-62"><code>func scalarMult(out, in, base *[32]byte) {</code></span>
<span class="codeline" id="line-63"><code>	var e [32]byte</code></span>
<span class="codeline" id="line-64"><code>	copy(e[:], (*in)[:])</code></span>
<span class="codeline" id="line-65"><code>	e[0] &amp;= 248</code></span>
<span class="codeline" id="line-66"><code>	e[31] &amp;= 127</code></span>
<span class="codeline" id="line-67"><code>	e[31] |= 64</code></span>
<span class="codeline" id="line-68"><code></code></span>
<span class="codeline" id="line-69"><code>	var t, z [5]uint64</code></span>
<span class="codeline" id="line-70"><code>	unpack(&amp;t, base)</code></span>
<span class="codeline" id="line-71"><code>	mladder(&amp;t, &amp;z, &amp;e)</code></span>
<span class="codeline" id="line-72"><code>	invert(&amp;z, &amp;z)</code></span>
<span class="codeline" id="line-73"><code>	mul(&amp;t, &amp;t, &amp;z)</code></span>
<span class="codeline" id="line-74"><code>	pack(out, &amp;t)</code></span>
<span class="codeline" id="line-75"><code>}</code></span>
<span class="codeline" id="line-76"><code></code></span>
<span class="codeline" id="line-77"><code>func setint(r *[5]uint64, v uint64) {</code></span>
<span class="codeline" id="line-78"><code>	r[0] = v</code></span>
<span class="codeline" id="line-79"><code>	r[1] = 0</code></span>
<span class="codeline" id="line-80"><code>	r[2] = 0</code></span>
<span class="codeline" id="line-81"><code>	r[3] = 0</code></span>
<span class="codeline" id="line-82"><code>	r[4] = 0</code></span>
<span class="codeline" id="line-83"><code>}</code></span>
<span class="codeline" id="line-84"><code></code></span>
<span class="codeline" id="line-85"><code>// unpack sets r = x where r consists of 5, 51-bit limbs in little-endian</code></span>
<span class="codeline" id="line-86"><code>// order.</code></span>
<span class="codeline" id="line-87"><code>func unpack(r *[5]uint64, x *[32]byte) {</code></span>
<span class="codeline" id="line-88"><code>	r[0] = uint64(x[0]) |</code></span>
<span class="codeline" id="line-89"><code>		uint64(x[1])&lt;&lt;8 |</code></span>
<span class="codeline" id="line-90"><code>		uint64(x[2])&lt;&lt;16 |</code></span>
<span class="codeline" id="line-91"><code>		uint64(x[3])&lt;&lt;24 |</code></span>
<span class="codeline" id="line-92"><code>		uint64(x[4])&lt;&lt;32 |</code></span>
<span class="codeline" id="line-93"><code>		uint64(x[5])&lt;&lt;40 |</code></span>
<span class="codeline" id="line-94"><code>		uint64(x[6]&amp;7)&lt;&lt;48</code></span>
<span class="codeline" id="line-95"><code></code></span>
<span class="codeline" id="line-96"><code>	r[1] = uint64(x[6])&gt;&gt;3 |</code></span>
<span class="codeline" id="line-97"><code>		uint64(x[7])&lt;&lt;5 |</code></span>
<span class="codeline" id="line-98"><code>		uint64(x[8])&lt;&lt;13 |</code></span>
<span class="codeline" id="line-99"><code>		uint64(x[9])&lt;&lt;21 |</code></span>
<span class="codeline" id="line-100"><code>		uint64(x[10])&lt;&lt;29 |</code></span>
<span class="codeline" id="line-101"><code>		uint64(x[11])&lt;&lt;37 |</code></span>
<span class="codeline" id="line-102"><code>		uint64(x[12]&amp;63)&lt;&lt;45</code></span>
<span class="codeline" id="line-103"><code></code></span>
<span class="codeline" id="line-104"><code>	r[2] = uint64(x[12])&gt;&gt;6 |</code></span>
<span class="codeline" id="line-105"><code>		uint64(x[13])&lt;&lt;2 |</code></span>
<span class="codeline" id="line-106"><code>		uint64(x[14])&lt;&lt;10 |</code></span>
<span class="codeline" id="line-107"><code>		uint64(x[15])&lt;&lt;18 |</code></span>
<span class="codeline" id="line-108"><code>		uint64(x[16])&lt;&lt;26 |</code></span>
<span class="codeline" id="line-109"><code>		uint64(x[17])&lt;&lt;34 |</code></span>
<span class="codeline" id="line-110"><code>		uint64(x[18])&lt;&lt;42 |</code></span>
<span class="codeline" id="line-111"><code>		uint64(x[19]&amp;1)&lt;&lt;50</code></span>
<span class="codeline" id="line-112"><code></code></span>
<span class="codeline" id="line-113"><code>	r[3] = uint64(x[19])&gt;&gt;1 |</code></span>
<span class="codeline" id="line-114"><code>		uint64(x[20])&lt;&lt;7 |</code></span>
<span class="codeline" id="line-115"><code>		uint64(x[21])&lt;&lt;15 |</code></span>
<span class="codeline" id="line-116"><code>		uint64(x[22])&lt;&lt;23 |</code></span>
<span class="codeline" id="line-117"><code>		uint64(x[23])&lt;&lt;31 |</code></span>
<span class="codeline" id="line-118"><code>		uint64(x[24])&lt;&lt;39 |</code></span>
<span class="codeline" id="line-119"><code>		uint64(x[25]&amp;15)&lt;&lt;47</code></span>
<span class="codeline" id="line-120"><code></code></span>
<span class="codeline" id="line-121"><code>	r[4] = uint64(x[25])&gt;&gt;4 |</code></span>
<span class="codeline" id="line-122"><code>		uint64(x[26])&lt;&lt;4 |</code></span>
<span class="codeline" id="line-123"><code>		uint64(x[27])&lt;&lt;12 |</code></span>
<span class="codeline" id="line-124"><code>		uint64(x[28])&lt;&lt;20 |</code></span>
<span class="codeline" id="line-125"><code>		uint64(x[29])&lt;&lt;28 |</code></span>
<span class="codeline" id="line-126"><code>		uint64(x[30])&lt;&lt;36 |</code></span>
<span class="codeline" id="line-127"><code>		uint64(x[31]&amp;127)&lt;&lt;44</code></span>
<span class="codeline" id="line-128"><code>}</code></span>
<span class="codeline" id="line-129"><code></code></span>
<span class="codeline" id="line-130"><code>// pack sets out = x where out is the usual, little-endian form of the 5,</code></span>
<span class="codeline" id="line-131"><code>// 51-bit limbs in x.</code></span>
<span class="codeline" id="line-132"><code>func pack(out *[32]byte, x *[5]uint64) {</code></span>
<span class="codeline" id="line-133"><code>	t := *x</code></span>
<span class="codeline" id="line-134"><code>	freeze(&amp;t)</code></span>
<span class="codeline" id="line-135"><code></code></span>
<span class="codeline" id="line-136"><code>	out[0] = byte(t[0])</code></span>
<span class="codeline" id="line-137"><code>	out[1] = byte(t[0] &gt;&gt; 8)</code></span>
<span class="codeline" id="line-138"><code>	out[2] = byte(t[0] &gt;&gt; 16)</code></span>
<span class="codeline" id="line-139"><code>	out[3] = byte(t[0] &gt;&gt; 24)</code></span>
<span class="codeline" id="line-140"><code>	out[4] = byte(t[0] &gt;&gt; 32)</code></span>
<span class="codeline" id="line-141"><code>	out[5] = byte(t[0] &gt;&gt; 40)</code></span>
<span class="codeline" id="line-142"><code>	out[6] = byte(t[0] &gt;&gt; 48)</code></span>
<span class="codeline" id="line-143"><code></code></span>
<span class="codeline" id="line-144"><code>	out[6] ^= byte(t[1]&lt;&lt;3) &amp; 0xf8</code></span>
<span class="codeline" id="line-145"><code>	out[7] = byte(t[1] &gt;&gt; 5)</code></span>
<span class="codeline" id="line-146"><code>	out[8] = byte(t[1] &gt;&gt; 13)</code></span>
<span class="codeline" id="line-147"><code>	out[9] = byte(t[1] &gt;&gt; 21)</code></span>
<span class="codeline" id="line-148"><code>	out[10] = byte(t[1] &gt;&gt; 29)</code></span>
<span class="codeline" id="line-149"><code>	out[11] = byte(t[1] &gt;&gt; 37)</code></span>
<span class="codeline" id="line-150"><code>	out[12] = byte(t[1] &gt;&gt; 45)</code></span>
<span class="codeline" id="line-151"><code></code></span>
<span class="codeline" id="line-152"><code>	out[12] ^= byte(t[2]&lt;&lt;6) &amp; 0xc0</code></span>
<span class="codeline" id="line-153"><code>	out[13] = byte(t[2] &gt;&gt; 2)</code></span>
<span class="codeline" id="line-154"><code>	out[14] = byte(t[2] &gt;&gt; 10)</code></span>
<span class="codeline" id="line-155"><code>	out[15] = byte(t[2] &gt;&gt; 18)</code></span>
<span class="codeline" id="line-156"><code>	out[16] = byte(t[2] &gt;&gt; 26)</code></span>
<span class="codeline" id="line-157"><code>	out[17] = byte(t[2] &gt;&gt; 34)</code></span>
<span class="codeline" id="line-158"><code>	out[18] = byte(t[2] &gt;&gt; 42)</code></span>
<span class="codeline" id="line-159"><code>	out[19] = byte(t[2] &gt;&gt; 50)</code></span>
<span class="codeline" id="line-160"><code></code></span>
<span class="codeline" id="line-161"><code>	out[19] ^= byte(t[3]&lt;&lt;1) &amp; 0xfe</code></span>
<span class="codeline" id="line-162"><code>	out[20] = byte(t[3] &gt;&gt; 7)</code></span>
<span class="codeline" id="line-163"><code>	out[21] = byte(t[3] &gt;&gt; 15)</code></span>
<span class="codeline" id="line-164"><code>	out[22] = byte(t[3] &gt;&gt; 23)</code></span>
<span class="codeline" id="line-165"><code>	out[23] = byte(t[3] &gt;&gt; 31)</code></span>
<span class="codeline" id="line-166"><code>	out[24] = byte(t[3] &gt;&gt; 39)</code></span>
<span class="codeline" id="line-167"><code>	out[25] = byte(t[3] &gt;&gt; 47)</code></span>
<span class="codeline" id="line-168"><code></code></span>
<span class="codeline" id="line-169"><code>	out[25] ^= byte(t[4]&lt;&lt;4) &amp; 0xf0</code></span>
<span class="codeline" id="line-170"><code>	out[26] = byte(t[4] &gt;&gt; 4)</code></span>
<span class="codeline" id="line-171"><code>	out[27] = byte(t[4] &gt;&gt; 12)</code></span>
<span class="codeline" id="line-172"><code>	out[28] = byte(t[4] &gt;&gt; 20)</code></span>
<span class="codeline" id="line-173"><code>	out[29] = byte(t[4] &gt;&gt; 28)</code></span>
<span class="codeline" id="line-174"><code>	out[30] = byte(t[4] &gt;&gt; 36)</code></span>
<span class="codeline" id="line-175"><code>	out[31] = byte(t[4] &gt;&gt; 44)</code></span>
<span class="codeline" id="line-176"><code>}</code></span>
<span class="codeline" id="line-177"><code></code></span>
<span class="codeline" id="line-178"><code>// invert calculates r = x^-1 mod p using Fermat's little theorem.</code></span>
<span class="codeline" id="line-179"><code>func invert(r *[5]uint64, x *[5]uint64) {</code></span>
<span class="codeline" id="line-180"><code>	var z2, z9, z11, z2_5_0, z2_10_0, z2_20_0, z2_50_0, z2_100_0, t [5]uint64</code></span>
<span class="codeline" id="line-181"><code></code></span>
<span class="codeline" id="line-182"><code>	square(&amp;z2, x)        /* 2 */</code></span>
<span class="codeline" id="line-183"><code>	square(&amp;t, &amp;z2)       /* 4 */</code></span>
<span class="codeline" id="line-184"><code>	square(&amp;t, &amp;t)        /* 8 */</code></span>
<span class="codeline" id="line-185"><code>	mul(&amp;z9, &amp;t, x)       /* 9 */</code></span>
<span class="codeline" id="line-186"><code>	mul(&amp;z11, &amp;z9, &amp;z2)   /* 11 */</code></span>
<span class="codeline" id="line-187"><code>	square(&amp;t, &amp;z11)      /* 22 */</code></span>
<span class="codeline" id="line-188"><code>	mul(&amp;z2_5_0, &amp;t, &amp;z9) /* 2^5 - 2^0 = 31 */</code></span>
<span class="codeline" id="line-189"><code></code></span>
<span class="codeline" id="line-190"><code>	square(&amp;t, &amp;z2_5_0)      /* 2^6 - 2^1 */</code></span>
<span class="codeline" id="line-191"><code>	for i := 1; i &lt; 5; i++ { /* 2^20 - 2^10 */</code></span>
<span class="codeline" id="line-192"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-193"><code>	}</code></span>
<span class="codeline" id="line-194"><code>	mul(&amp;z2_10_0, &amp;t, &amp;z2_5_0) /* 2^10 - 2^0 */</code></span>
<span class="codeline" id="line-195"><code></code></span>
<span class="codeline" id="line-196"><code>	square(&amp;t, &amp;z2_10_0)      /* 2^11 - 2^1 */</code></span>
<span class="codeline" id="line-197"><code>	for i := 1; i &lt; 10; i++ { /* 2^20 - 2^10 */</code></span>
<span class="codeline" id="line-198"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-199"><code>	}</code></span>
<span class="codeline" id="line-200"><code>	mul(&amp;z2_20_0, &amp;t, &amp;z2_10_0) /* 2^20 - 2^0 */</code></span>
<span class="codeline" id="line-201"><code></code></span>
<span class="codeline" id="line-202"><code>	square(&amp;t, &amp;z2_20_0)      /* 2^21 - 2^1 */</code></span>
<span class="codeline" id="line-203"><code>	for i := 1; i &lt; 20; i++ { /* 2^40 - 2^20 */</code></span>
<span class="codeline" id="line-204"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-205"><code>	}</code></span>
<span class="codeline" id="line-206"><code>	mul(&amp;t, &amp;t, &amp;z2_20_0) /* 2^40 - 2^0 */</code></span>
<span class="codeline" id="line-207"><code></code></span>
<span class="codeline" id="line-208"><code>	square(&amp;t, &amp;t)            /* 2^41 - 2^1 */</code></span>
<span class="codeline" id="line-209"><code>	for i := 1; i &lt; 10; i++ { /* 2^50 - 2^10 */</code></span>
<span class="codeline" id="line-210"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-211"><code>	}</code></span>
<span class="codeline" id="line-212"><code>	mul(&amp;z2_50_0, &amp;t, &amp;z2_10_0) /* 2^50 - 2^0 */</code></span>
<span class="codeline" id="line-213"><code></code></span>
<span class="codeline" id="line-214"><code>	square(&amp;t, &amp;z2_50_0)      /* 2^51 - 2^1 */</code></span>
<span class="codeline" id="line-215"><code>	for i := 1; i &lt; 50; i++ { /* 2^100 - 2^50 */</code></span>
<span class="codeline" id="line-216"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-217"><code>	}</code></span>
<span class="codeline" id="line-218"><code>	mul(&amp;z2_100_0, &amp;t, &amp;z2_50_0) /* 2^100 - 2^0 */</code></span>
<span class="codeline" id="line-219"><code></code></span>
<span class="codeline" id="line-220"><code>	square(&amp;t, &amp;z2_100_0)      /* 2^101 - 2^1 */</code></span>
<span class="codeline" id="line-221"><code>	for i := 1; i &lt; 100; i++ { /* 2^200 - 2^100 */</code></span>
<span class="codeline" id="line-222"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-223"><code>	}</code></span>
<span class="codeline" id="line-224"><code>	mul(&amp;t, &amp;t, &amp;z2_100_0) /* 2^200 - 2^0 */</code></span>
<span class="codeline" id="line-225"><code></code></span>
<span class="codeline" id="line-226"><code>	square(&amp;t, &amp;t)            /* 2^201 - 2^1 */</code></span>
<span class="codeline" id="line-227"><code>	for i := 1; i &lt; 50; i++ { /* 2^250 - 2^50 */</code></span>
<span class="codeline" id="line-228"><code>		square(&amp;t, &amp;t)</code></span>
<span class="codeline" id="line-229"><code>	}</code></span>
<span class="codeline" id="line-230"><code>	mul(&amp;t, &amp;t, &amp;z2_50_0) /* 2^250 - 2^0 */</code></span>
<span class="codeline" id="line-231"><code></code></span>
<span class="codeline" id="line-232"><code>	square(&amp;t, &amp;t) /* 2^251 - 2^1 */</code></span>
<span class="codeline" id="line-233"><code>	square(&amp;t, &amp;t) /* 2^252 - 2^2 */</code></span>
<span class="codeline" id="line-234"><code>	square(&amp;t, &amp;t) /* 2^253 - 2^3 */</code></span>
<span class="codeline" id="line-235"><code></code></span>
<span class="codeline" id="line-236"><code>	square(&amp;t, &amp;t) /* 2^254 - 2^4 */</code></span>
<span class="codeline" id="line-237"><code></code></span>
<span class="codeline" id="line-238"><code>	square(&amp;t, &amp;t)   /* 2^255 - 2^5 */</code></span>
<span class="codeline" id="line-239"><code>	mul(r, &amp;t, &amp;z11) /* 2^255 - 21 */</code></span>
<span class="codeline" id="line-240"><code>}</code></span>
</pre><pre id="footer">
<table><tr><td><img src="../../../../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.1.6</i>. (GOOS=darwin GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project and developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table
</pre>
</div></body></html>